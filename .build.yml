image: alpine/edge
packages:
  - ruby-dev
  - nodejs
  - npm
environment:
  repo: this-and-that 
sources:
  - https://git.sr.ht/~stfn/this-and-that
  - https://git.sr.ht/~stfn/build-scripts
secrets:
  - 4aa75533-97a7-429e-b7b0-4f9f3e564ced # ~/.neocities/$repo
tasks:
  - setup: |
      sudo gem install --no-document bundler neocities
      sudo npm install html-minifier -g
  - build: |
      cd $repo
      sh ../build-scripts/jekyll-build
      html-minifier --input-dir _site --output-dir _site --collapse-whitespace --file-ext html
  - deploy: |
      cd $repo
      sh ../build-scripts/neocities-deploy $repo _site
